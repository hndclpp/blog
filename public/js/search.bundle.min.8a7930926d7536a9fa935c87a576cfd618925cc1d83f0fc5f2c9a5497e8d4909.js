document.addEventListener("DOMContentLoaded",function(){const s=document.getElementById("search-input"),h=document.getElementById("search-button"),e=document.getElementById("search-results"),l=document.getElementById("search-skeleton"),u=document.getElementById("search-history"),n=document.getElementById("pagination");let r,o=[];const c=5;let t=1;fetch("/index.json").then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{if(!Array.isArray(e)||e.length===0)throw new Error("Invalid search index data");const t={keys:[{name:"title",weight:.7},{name:"summary",weight:.3},{name:"content",weight:.3}],threshold:.2,includeScore:!0,minMatchCharLength:2};r=new Fuse(e,t),m()}).catch(t=>{console.error("Error loading search index:",t),e.innerHTML='<p class="error">搜索功能加载失败，请稍后再试。</p>'});function i(){const i=s.value.trim();if(!i||!r){e.innerHTML="";return}e.style.display="none",n.style.display="none",l.style.display="block",setTimeout(()=>{try{if(o=r.search(i),l.style.display="none",e.style.display="block",o.length===0){e.innerHTML='<p class="no-results">未找到相关结果</p>',n.style.display="none";return}t=1,d(1),a(),p(i),n.style.display="flex"}catch{l.style.display="none",e.style.display="block",e.innerHTML='<p class="error">搜索出错，请重试</p>',n.style.display="none"}},500)}function d(t){const n=(t-1)*c,s=n+c,i=o.slice(n,s);e.innerHTML="",i.forEach(t=>{const s=t.item,o=document.createElement("div");o.className="search-result-item";let n=s.summary||s.content;n=n.length>100?n.substring(0,100)+"...":n,o.innerHTML=`
                <a href="${s.permalink}" class="search-result-item-link">
                    <div class="search-result-title">${s.title}</div>
                    <div class="search-result-summary">${n}</div>
                </a>
            `,e.appendChild(o)})}function a(){const e=Math.ceil(o.length/c);if(n.innerHTML="",e>1){const s=document.createElement("button");s.textContent="上一页",s.disabled=t===1,s.addEventListener("click",()=>{t>1&&(t--,d(t),a())}),n.appendChild(s);const o=document.createElement("button");o.textContent="下一页",o.disabled=t===e,o.addEventListener("click",()=>{t<e&&(t++,d(t),a())}),n.appendChild(o)}}function p(e){let t=JSON.parse(localStorage.getItem("searchHistory"))||[];t.includes(e)||(t.unshift(e),t.length>5&&t.pop(),localStorage.setItem("searchHistory",JSON.stringify(t)),f())}function m(){f()}function f(){const e=JSON.parse(localStorage.getItem("searchHistory"))||[];u.innerHTML="",e.forEach(e=>{const t=document.createElement("span");t.textContent=e,t.addEventListener("click",()=>{s.value=e,i()}),u.appendChild(t)})}if(h&&h.addEventListener("click",i),s){s.addEventListener("keypress",function(e){e.key==="Enter"&&i()});let e;s.addEventListener("input",function(){clearTimeout(e),e=setTimeout(i,300)})}m()})